<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=8">
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<title>洗白地域黑</title>
	<link rel="stylesheet" href="./css/main.css?s2">
</head>
<style>
	canvas {
		scale: 0.5
	}

	.o-img,.img-container img{
		margin: auto;
		width: 5.62rem;
        height: 9rem;
        display: block;
	}
	.canvasBox{
		margin: 0 auto;
		width: 320px;
		height: 475px;
		/*background:url({$source}) no-repeat ;*/
		/*background-size: 100% 100%;*/
	}
	.canvasBox img{
		width: 320px;
		height: 475px;
    }
    .five-fightImg01{
        width: 7.5rem;
        height: 0.86rem;
        display: block;
        margin: 0 auto;
        margin-bottom: 0.5rem;
    }
    .five-fightImg02{
        width: 3.65rem;
        height: 0.44rem;
        display: block;
        margin: 0.3rem auto;
    }
    .imgalert{
        width:3.63rem ;
        height: 2.66rem;
        position: absolute;
        left: 0;
        right: 0;
        margin: auto;
        top: 2.26rem;
    }
    .leftright-bigTxt{
        color: #D64F24;
        font-size: 0.56rem;
        text-align: center;
        margin: 0 auto;
        margin-bottom: 0.6rem;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
    }
    .leftright-bigTxt img{
        width: 0.5rem;
        height: 0.5rem;
    }
</style>

<body>
<div class="wap-wrap">
	<!-- <div class="five-back" id="Download">
		<img src="http://cdn.indus-robot.cn/leftright11.png" alt="">
        <img src="http://cdn.indus-robot.cn/leftright12.png" alt="">
    </div> -->
    <img src="./img/city03.png" class="five-fightImg01" alt="">
    <div class="img-container touchBox" ></div>
    <div style="opacity: 0;">
        <div class="PicBox" id="content2" style="position: relative; width: 1000px;height: 1600px;margin: 0 auto;overflow: hidden;">
                <!-- 头像 -->
                <img src="./img/allGood04.png" alt="" style="width:100px;height:100px;left:23px;top:49px;position:absolute;">
                <!-- 背景图 -->
                <img src="./img/city06.png" alt="" style="left:0;top:0;position:absolute;width: 1000px;height: 1600px">
                <!-- 名字 -->
                <div style="font-size:40px;color:#000;text-align: center;width: 250px;top:80px;left: 210px;position: absolute;overflow: hidden;">名字</div>
                <img src="" alt="" style="width:197px;height:197px;position:absolute;left: 715px;top: 1324px" class="code3img">
        </div>
    </div>
    <!-- <img src="http://cdn.indus-robot.cn/tenyear2_07.png" class="imgalert" alt=""> -->
    <img src="./img/city05.png" class="five-fightImg02" alt="">
    <div id="code3" style="display:none"></div>
</div>
</body>
<script src="./js/jquery-1.9.1.min.js"></script>
<script src="./js/html2canvas.min.js"></script>
<script src="./js/canvas2image.js"></script>
<script src="./js/qrcode.min.js"></script>
<script>
    var str = toUtf8("www.baidu.com");
    $("#code3").qrcode({

    render: "canvas",

    width: 300,

    height:300,

    text: str

    });
    
    var codecanvas =  $('#code3 canvas')[0]
    convertCanvasToImage(codecanvas);
    function convertCanvasToImage(canvas) {
        //var image = new Image();
        var imgUrl= canvas.toDataURL("image/png");
        $(".code3img").attr('src',imgUrl); 
        $("#code2").attr('src',imgUrl);
        console.log(imgUrl)

        //return image;
    }


    var dom=$("#content2"); //你要转变的dom
        var width = dom.width();
        var height = dom.height();
        var type = "png";
        var scaleBy = 3;  //缩放比例
        var canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = height+35;  //35是我处理完后发现短了一点，具体为什么不清楚,如果你也少的话，根据自己的项目调吧
        canvas.style.width = width + 'px';
        canvas.style.height = height + 'px';
        var context = canvas.getContext('2d');
        // 【重要】关闭抗锯齿
        context.mozImageSmoothingEnabled = false;
        context.webkitImageSmoothingEnabled = false;
        context.msImageSmoothingEnabled = false;
        context.imageSmoothingEnabled = false;
        context.scale(scaleBy, scaleBy);
        html2canvas(dom[0], {
            canvas:canvas,
            scale: 3, 
            onrendered: function (canvas) {
                dom.css("display","none");//处理完后将dom隐藏,如果一开始就隐藏的话,canvas出不来,不知道大家是不是这样
                //convertCanvasToImage(canvas);
        
                $(".img-container").append(Canvas2Image.convertToImage(canvas,width,height,type));//这是放大了很3倍的图片
                //$(".img-container img").css("width","320px").css("height","475px");//在将放大的图片用css缩小,在手机上就非常清晰了
                
            }
        });

    function toUtf8(str) {

        var out, i, len, c;

        out = "";

        len = str.length;

        for (i = 0; i < len; i++) {

            c = str.charCodeAt(i);

            if ((c >= 0x0001) && (c <= 0x007F)) {

                out += str.charAt(i);

            } else if (c > 0x07FF) {

                out += String.fromCharCode(0xE0 | ((c >> 12) & 0x0F));

                out += String.fromCharCode(0x80 | ((c >> 6) & 0x3F));

                out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));

            } else {

                out += String.fromCharCode(0xC0 | ((c >> 6) & 0x1F));

                out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));

            }

        }

        return out;

    }
</script>

</html>
<script>
    function onBridgeReady() {
        WeixinJSBridge.call('hideOptionMenu');
    }

    if (typeof WeixinJSBridge == "undefined") {
        if (document.addEventListener) {
            document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
        } else if (document.attachEvent) {
            document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
            document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
        }
    } else {
        onBridgeReady();
    }
</script>