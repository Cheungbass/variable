var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)},LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.createView,t),t}return __extends(t,e),t.prototype.createView=function(){var e=this;RES.getResAsync("bg",function(){var t=new egret.Bitmap(RES.getRes("bg"));t.width=e.stage.stageWidth,t.height=e.stage.stageHeight;var a=new egret.TextField;a.y=.45*e.stage.stageHeight,a.width=640,a.height=50,a.textAlign="center",a.text="Loading",a.textColor=0,e.textField=new egret.TextField,e.textField.y=a.y+a.height,e.textField.width=640,e.textField.height=100,e.textField.textAlign="center",e.textField.textColor=0,e.textField.text="0%",e.addChild(t),e.addChild(a),e.addChild(e.textField),RES.setMaxLoadingThread(6),RES.loadGroup("preload")},this)},t.prototype.setProgress=function(e,t){this.textField.text=Math.floor(Math.round(e/t*100))+"%"},t}(egret.DisplayObjectContainer);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){var t=this;$.ajax({url:"resource/default.res.json",dataType:"json",success:function(e){t.onConfigComplete(e)}})},t.prototype.onConfigComplete=function(e){var t={groups:[{keys:"",name:"preload"}],resources:[]};t.resources=e.resources;for(var a=0;a<t.resources.length;a++)t.groups[0].keys+=","+t.resources[a].name;RES.parseConfig(t,"resource/"),RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView)},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.createGameScene=function(){this.addChild(new Page1)},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Page1=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){var e=this,t=new egret.Bitmap(RES.getRes("imgs.bg"));t.width=this.stage.stageWidth,t.height=this.stage.stageHeight;var a=new egret.Bitmap(RES.getRes("imgs.qi"));a.anchorOffsetX=a.width/2,a.x=this.stage.stageWidth/2,a.y=this.stage.stageHeight/2-a.height/2,a.alpha=0;var s=new egret.DisplayObjectContainer;s.width=568,s.height=135,s.anchorOffsetX=s.width/2,s.x=this.stage.stageWidth/2,s.y=600/1138*this.stage.stageHeight+150,s.alpha=0;var i=new egret.Bitmap(RES.getRes("imgs.t1")),n=new egret.Bitmap(RES.getRes("imgs.zhe"));n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.x=s.width/2,n.y=s.height/2,n.scaleX=n.scaleY=2,n.mask=i;var g=new egret.Bitmap(RES.getRes("imgs.btn"));g.anchorOffsetX=g.width/2,g.anchorOffsetY=g.height/2,g.x=this.stage.stageWidth/2,g.y=880/1138*this.stage.stageHeight,g.alpha=0;var r=new egret.Bitmap(RES.getRes("imgs.logo"));r.anchorOffsetX=r.width/2,r.x=this.stage.stageWidth/2,r.y=1006/1138*this.stage.stageHeight,r.alpha=0,s.addChild(n),s.addChild(i),this.addChild(t),this.addChild(a),this.addChild(s),this.addChild(g),this.addChild(r),egret.Tween.get(n,{loop:!0}).to({rotation:360},1e4),egret.Tween.get(n,{loop:!0}).to({scaleX:3,scaleY:3},5e3).to({scaleX:2,scaleY:2},5e3),egret.Tween.get(a).to({alpha:1},800).wait(1e3).call(function(){var t=document.getElementById("media");t.play(),egret.Tween.get(a).to({y:124/1138*e.stage.stageHeight},2e3,egret.Ease.sineOut).call(function(){var t;t=e.stage.stageHeight<=1009?650/1138*e.stage.stageHeight:1009<e.stage.stageHeight&&e.stage.stageHeight<=1140?630/1138*e.stage.stageHeight:600/1138*e.stage.stageHeight,egret.Tween.get(s).to({y:t,alpha:1},2e3,egret.Ease.sineOut).call(function(){egret.Tween.get(r).to({y:1006/1138*e.stage.stageHeight,alpha:1},1e3,egret.Ease.sineOut),egret.Tween.get(g).to({y:880/1138*e.stage.stageHeight,alpha:1},1e3,egret.Ease.sineOut).call(function(){egret.Tween.get(g,{loop:!0}).to({scaleX:1.03,scaleY:1.03},800).to({scaleX:1,scaleY:1},800),g.touchEnabled=!0},e)},e)},e)},this),g.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){if(t.stopPropagation(),t.preventDefault(),!isWx){var i=document.getElementById("media");i.play()}g.touchEnabled=!1,egret.Tween.removeAllTweens(),egret.Tween.get(g).to({alpha:0},500),egret.Tween.get(r).to({alpha:0},500),egret.Tween.get(s).to({alpha:0},500).call(function(){n.mask=null,egret.Tween.get(a).to({y:10/1138*e.stage.stageHeight},1500,egret.Ease.sineOut).call(function(){e.parent.addChild(new Page2),e.parent.removeChild(e)},e)},e)},this)},t}(egret.DisplayObjectContainer);__reflect(Page1.prototype,"Page1");var Page2=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){var e=this,t=new egret.Bitmap(RES.getRes("imgs.bg"));t.width=this.stage.stageWidth,t.height=this.stage.stageHeight;var a=new egret.Bitmap(RES.getRes("imgs.qi"));a.anchorOffsetX=a.width/2,a.x=this.stage.stageWidth/2,a.y=10/1138*this.stage.stageHeight;var s=new egret.DisplayObjectContainer;s.width=640,s.height=230,s.anchorOffsetX=s.width/2,s.x=this.stage.stageWidth/2,s.y=514/1138*this.stage.stageHeight+150,s.alpha=0;var i=new egret.Bitmap(RES.getRes("imgs.t2"));i.anchorOffsetX=i.width/2,i.x=s.width/2,i.y=0;var n=new egret.Bitmap(RES.getRes("imgs.zhe"));n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.x=s.width/2,n.y=i.y+i.height/2,n.scaleX=n.scaleY=2,n.mask=i;var g=new egret.BitmapText;g.font=RES.getRes("myFont.fnt"),g.width=750,g.height=69,g.anchorOffsetX=g.width/2,g.x=s.width/2,g.y=i.y+i.height+70,g.textAlign=egret.HorizontalAlign.CENTER,g.text="我是第0位护旗手",g.letterSpacing=1,g.scaleX=g.scaleY=.9,manNum>=1e6&&(g.scaleX=g.scaleY=.85);var r=new egret.Bitmap(RES.getRes("imgs.tip"));r.anchorOffsetX=r.width/2,r.x=this.stage.stageWidth/2,r.y=868/1138*this.stage.stageHeight,r.alpha=0;var o=new egret.Bitmap(RES.getRes("tip22"));o.anchorOffsetX=o.width/2,o.x=this.stage.stageWidth/2,o.y=868/1138*this.stage.stageHeight,o.alpha=0;var h=new egret.Bitmap(RES.getRes("imgs.logo2"));h.anchorOffsetX=h.width/2,h.x=this.stage.stageWidth/2,h.y=984/1138*this.stage.stageHeight,h.alpha=0,s.addChild(n),s.addChild(i),s.addChild(g),this.addChild(t),this.addChild(a),this.addChild(s),this.addChild(r),this.addChild(o),this.addChild(h),egret.Tween.get(n,{loop:!0}).to({rotation:360},1e4),egret.Tween.get(n,{loop:!0}).to({scaleX:3,scaleY:3},5e3).to({scaleX:2,scaleY:2},5e3);var d,l,c=0,p=0;l=this.stage.stageHeight<=1009?534/1138*this.stage.stageHeight:514/1138*this.stage.stageHeight,egret.Tween.get(s).to({y:l,alpha:1},800,egret.Ease.sineOut),d=setInterval(function(){if(c=Math.floor(500*Math.random())+1e4,p+=c,p>=manNum){p=manNum,clearInterval(d);var t=p+"";if(p>0&&1e3>p)g.text="我是第"+t+"位护旗手";else if(p>=1e3&&1e6>p)g.text="我是第"+t.substring(0,t.length-3)+","+t.substring(t.length-3)+"位护旗手";else{var a=t.substring(t.length-6);g.text="我是第"+t.substring(0,t.length-6)+","+a.substring(0,a.length-3)+","+a.substring(a.length-3)+"位护旗手"}egret.Tween.get(o).to({alpha:1},400),egret.Tween.get(h).to({alpha:1},400,egret.Ease.sineOut).call(function(){o.alpha=0,r.alpha=1;var t=new egret.RenderTexture;t.drawToTexture(e,new egret.Rectangle(0,0,e.stage.stageWidth,e.stage.stageHeight));var a=t.toDataURL("image/png",new egret.Rectangle(0,0,e.stage.stageWidth,e.stage.stageHeight));$("#fu").attr("src",a).show(),o.alpha=1,r.alpha=0},e)}else{var t=p+"";if(p>0&&1e3>p)g.text="我是第"+t+"位护旗手";else if(p>=1e3&&1e6>p)g.text="我是第"+t.substring(0,t.length-3)+","+t.substring(t.length-3)+"位护旗手";else{var a=t.substring(t.length-6);g.text="我是第"+t.substring(0,t.length-6)+","+a.substring(0,a.length-3)+","+a.substring(a.length-3)+"位护旗手"}}},this,300)},t}(egret.DisplayObjectContainer);__reflect(Page2.prototype,"Page2");