!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("_ks_trace",t):e._ks_trace=t()}(this,function(){"use strict";var a,e,i,t,n,o,c=function(){return(c=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};(e=a||(a={}))[e.JS_UNKNOWN=0]="JS_UNKNOWN",e[e.JS_PAGE_LOAD=1]="JS_PAGE_LOAD",e[e.JS_PAGE_LOAD_DONE=2]="JS_PAGE_LOAD_DONE",e[e.JS_LOAD_FAILED=3]="JS_LOAD_FAILED",e[e.JS_CLICK1=10]="JS_CLICK1",e[e.JS_CLICK2=11]="JS_CLICK2",e[e.JS_CLICK3=12]="JS_CLICK3",(t=i||(i={})).click1="click1",t.click2="click2",t.click3="click3",(o=n||(n={}))[o.EVENT_UNKNOWN=0]="EVENT_UNKNOWN",o[o.EVENT_CONVERSION=1]="EVENT_CONVERSION",o[o.EVENT_REGISTER=2]="EVENT_REGISTER",o[o.EVENT_PAY=3]="EVENT_PAY",o[o.EVENT_JS=4]="EVENT_JS";Boolean(window.navigator&&window.navigator.sendBeacon),document.hidden;var r=function(e){var t=new RegExp("(^|&)"+e+"=([^&|#]*)(&|#|$)"),n=-1<window.location.href.indexOf("?")?window.location.href.split("?")[1].match(t):null;return null!=n?decodeURIComponent(n[2]):null},s=new(function(){function o(){this.init()}return o.prototype.push=function(e){var n=this,o=e.event,t=e.cb;new Promise(function(e,t){switch(o){case a.JS_PAGE_LOAD:n.sendPageLoad();break;case a.JS_PAGE_LOAD_DONE:n.sendPageLoadDone();break;case i.click1:n.sendEvent(a.JS_CLICK1,e);break;case i.click2:n.sendEvent(a.JS_CLICK2,e);break;case i.click3:n.sendEvent(a.JS_CLICK3,e);break;default:throw new Error("event is not valid, please check your data-ks-event attibute or parameter")}}).then(function(){t&&t()}).catch(function(e){console.log(e),t()})},o.prototype.init=function(){this.callback=r("callback")},o.prototype.send=function(t){if(this.callback){var e=o.url+"?"+Object.keys(t).filter(function(e){if("resolve"!==e)return t[e]}).map(function(e){return"object"==typeof t[e]&&(t[e]=JSON.stringify(t[e])),e+"="+t[e]}).join("&"),n=new XMLHttpRequest;n.open("GET",e,!0),n.send(null),n.addEventListener("readystatechange",function(){4==n.readyState&&t.resolve&&t.resolve()})}else t.resolve&&t.resolve()},o.prototype.sendEvent=function(e,t){this.send(c({jsEventType:e,resolve:t},this.generateParams()))},o.prototype.sendPageLoad=function(){this.send(c({jsEventType:a.JS_PAGE_LOAD},this.generateParams()))},o.prototype.sendPageLoadDone=function(){this.send(c({jsEventType:a.JS_PAGE_LOAD_DONE},this.generateParams()))},o.prototype.generateParams=function(){return{callback:this.callback,eventType:n.EVENT_JS,eventTime:Date.now()}},o.url="https://e.kuaishou.com/rest/log/activate",o}());return(new(function(){function e(){}return e.prototype.init=function(){var e=this;s.push({event:a.JS_PAGE_LOAD}),document.addEventListener("readystatechange",function(){"complete"===document.readyState&&(e.bindEvents(),s.push({event:a.JS_PAGE_LOAD_DONE}))})},e.prototype.bindEvents=function(){var e=document.querySelectorAll("[data-ks-click]");[].forEach.call(e,function(t){t.addEventListener("click",function(){var e=t.getAttribute("data-ks-event");s.push({event:e})})})},e}())).init(),s});
